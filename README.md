# ARSnakeAI

## 프로젝트 설명

고전 게임인 snake 게임에 인공지능을 적용하여, 뱀이 학습을 통해 점차 나은 게임 실력을 보여주는 것을 AR 모드로 구경(?) 할 수 있는 앱을 제작해 보았습니다. 

### snake 게임이란?

![image](https://user-images.githubusercontent.com/70687318/159568851-8c5a7b13-9503-4041-aaf5-4c4d246e523d.png)


아주 단순한 형태의 고전게임. 뱀(흰색)이 존재하며, 먹이(빨간색)을 먹을 수록 꼬리가 길어집니다. 자신의 몸에 부딪히거나, 벽에 부딪히면 게임 오버. 먹이를 먹을 수록 몸의 길이가 길어지므로 게임플레이가 점점 어려워진다는 특징이 있습니다.

기본적인 게임의 코드로는 깃허브에 올라와 있는 swift 언어로 이루어진 ios 앱 전용 소스코드를 활용하였습니다.

[출처] https://github.com/PGSSoft/3DSnakeAR

AR 모드도 바로 사용이ㄱ

인공지능 적용

- 유전 알고리즘

유전 알고리즘 (Genetic Algorithm) 을 활용한다. 이 때 유전 알고리즘이란 존 홀랜드가 다윈 진화론의 적자생존에 기반하여 개발한 최적화 연산 방법으로, 진화론에서 최종적으로 살아남는 종은 변화에 가장 발빠르게 적응하는 종이라는 점이라는 이론을 활용하며, 생물학의 적자생존 법칙을 모방한다.

전체적인 과정

1) 환경에 적합한 개체가 살아남음 (fitness)

2) 살아남은 개체가 번식에 성공 (natural selection)

3) 짝지어진 부모의 유전자 (crossover) + 돌연변이 (mutation) 로 자손 생성

이를 뱀게임에 적용하여 설명하면, 여러마리의 뱀을 풀어서 마음대로 플레이 하도록 명령한 뒤, 꼬리가 길어진 정도, 살아남은 시간에 따라 각각 개체의 적응도 (fitness) 를 측정한다는 것이다. 이후 적응도가 높은 뱀은 살리며, 나머지 뱀들은 다시 새로운 개체로 교체한다. 이 때 교배 (crossover) 가 이루어지며 세대가 바뀌는데, 이 과정에 돌연변이 (mutation) 를 적용하여 돌연변이를 통한 진화의 가능성도 고려해 준다.

뱀게임에 유전 알고리즘을 적용하기 위하여 이와 관련된 영상들을 시청하며 소스코드를 분석하였다.

[출처] https://www.youtube.com/watch?v=zIkBYwdkuTk

[출처] https://github.com/greerviau/SnakeAI

Processing 언어로 작성된 소스코드를 ios 앱에 적용하기 위해 swift 코드로 작성하는 과정이 필요하였고, 이를 위해선 기존소스코드에 대한 높은 수준의 이해도가 요구되었다. 따라서, 이 과정에 많은 시간을 투자하였다.

- 인공 신경망

다음은, 인공신경망의 구성에 관한 간략한 설명이다.



사진 삭제
사진 설명을 입력하세요.

이번 프로젝트에 적용된, 뱀에 뇌라고 볼 수 있는 인공신경망의 구조는 위의 이미지와 같다. 첫번째 입력층에 24개의 input neurons 이 존재하며, 이후 2개의 히든층에 18개씩 hidden neurons 이 존재한다. 마지막으로 output neurons 은 4개이다.

입력층의 24개의 뉴런이 의미하는 바는 다음 이미지의 8가지 방향과 관련이 있다.



사진 삭제
사진 설명을 입력하세요.

뱀의 머리에 8가지의 센서를 달았다고 생각하면 편하겠다. 2D 상에서 뱀의 머리가 바라볼 수 있는 모든 방향은 위와 같이 8가지이다. 해당 8가지의 방향으로 각각 음식이 얼마나 떨어져 있는지, 자신의 몸과 얼마나 떨어져 있는지, 벽과 얼마나 멀리 떨어져 있는지를 측정한다. 즉 각각의 방향에서 3가지의 요소를 측정하므로 실제로 입력되는 input 은 8 * 3 인 24개의 neuron 인것이다.

마지막 4개의 output 은 움직일 방향이다. 왼쪽, 오른쪽, 위쪽, 아래쪽이 존재하므로 4가지인 것이다.

즉 24개의 센서를 통한 인풋을 입력받은 후, 2개의 히든층을 거쳐 판단을 한 뒤, 4가지 방향 중 한가지 방향을 선택하여 움직이는 것이다.

시행착오 및 해결

소스코드 분석을 마친 뒤, 앞서 준비한 기본적인 ios 전용 snake 게임에 해당 유전 알고리즘을 적용하는 과정을 진행하였다. 이 때, 예상치 못하였다면 거짓말인 메모리 초과 문제를 마주하게 되었다.

기존의 Processing 언어로 작성된 소스코드는 총 2000 마리에 뱀을 동시에 학습시킨다. 그러나 ios 앱에서는 약 500 마리에 뱀을 동시에 학습하는 것이 최대였으며, 이 또한 불안정했다. 개체수가 너무 적어, 학습하는데 너무 오랜 시간이 걸린다고 판단하였고, 이에 따라 방식을 변경하기로 하였다.

변경한 방식은 ios 앱 내부에서 학습을 수행하는 것이 아닌, 이를 불러올 수 있는 코드를 작성하여, 미리 학습된 모델을 불러와 인공지능을 시뮬레이션 하는 용도로 사용하는 것이었다. Processing 언어로 작성한 소스코드 즉, 컴퓨터로 수행할 수 있는 프로그램에서 모델을 학습시킨 후 이를 csv 파일에 저장하였고, ios 앱의 패키지에 포함시켰다.

쉽게 말해, 미리 뱀의 뇌를 학습시켜 놓은 뒤, ios 앱에서 이를 장착하여 시뮬레이션 하는 방식인 것이다.

커스터 마이징

 

사진 삭제
사진 설명을 입력하세요.

다음으로 약간의 커스터 마이징을 진행하였다. 우선, 뱀의 우리가 너무 작다고 판단하여 크기를 늘렸으며, 한 마리 보다 동시에 여러 마리가 학습하는 시뮬레이션이 더 흥미로울 것 같다고 판단하여 동시에 뱀이 다섯마리가 출현하도록 변경하였다. 또한, 이를 구별하기 위해 각각에 색을 달리하였다.



사진 삭제
사진 설명을 입력하세요.

AR 모드에선 기존의 single play 모드와 AI 시뮬레이션 모드를 선택할 수 있으며, AI 모드 내에선 뱀의 generation 을 선택할수 있다. 이를 통해 학습이 세대별로 순차적으로 이루어지는 것을 기다리는게 아닌, 바로 학습된 모델을 불러올 수 있도록 하였다.

시연 영상

 

17:54
[백팀] ARSnakeAI 시연회 (1)[백팀] ARSnakeAI 시연회 (1)
대표
동영상 설명을 입력하세요.

snake3D simulatoin

- 기본적인 룰에 lifetime 을 추가하여, 일정 시간동안 먹이를 먹지 않는다면 죽는 방식으로 뱀이 무한 루프에 빠지는 문제를 해결했다.

- 바쁘신 분은 초반부와 14분 40초 부터만 시청하셔도 무방할 것 같습니다.

 

00:20
[백팀] ARSnakeAI 시연회 (2)[백팀] ARSnakeAI 시연회 (2)
대표
동영상 설명을 입력하세요.

snakeAR single mode

- 조작은 화면을 쓸어넘기는 제스쳐를 통해 이루어 진다.



1:14
[백팀] ARSnakeAI 시연회 (3)[백팀] ARSnakeAI 시연회 (3)
대표
동영상 설명을 입력하세요.

snakeAR AIPlay mode

- 선택 가능한 최대 세대는 34 세대로, 이는 34세대 이후로 50세대가 넘어가도록 진전이 없었기 때문이다.

- 34 세대까지 시뮬레이션을 기다리려면 약 3~40 분 가량이 걸리기 때문에, 바로 세대를 점프할 수 있는 기능을 추가하였다.

마치며

아이폰의 apk 특성상 배포가 불가하여 영상으로 대체하였습니다. 추후에 소스코드가 필요하시거나 앱 시연을 희망하시는 아이폰 지참 후 연락 주신다면, 그리고 희망자가 많으시다면 하루 날잡아 학교에서 뵙고 xcode로 배포해 드리는 것도 괜찮을 것 같네요. 속상한건, 배포해 드려도 개발자 등록 (매년 10만원)이 안되어 있다면 1주일 후엔 앱 사용이 불가합니다.

﻿
