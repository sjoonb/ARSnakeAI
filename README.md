# ARSnakeAI

## 프로젝트 설명

고전 게임인 snake 게임에 인공지능을 적용하여, 뱀이 학습을 통해 점차 나은 게임 실력을 보여주는 것을 AR 모드로 구경(?) 할 수 있는 앱을 제작해 보았습니다. 

### snake 게임이란?

![image](https://user-images.githubusercontent.com/70687318/159568851-8c5a7b13-9503-4041-aaf5-4c4d246e523d.png)


아주 단순한 형태의 고전게임. 뱀(흰색)이 존재하며, 먹이(빨간색)을 먹을 수록 꼬리가 길어집니다. 자신의 몸에 부딪히거나, 벽에 부딪히면 게임 오버. 먹이를 먹을 수록 몸의 길이가 길어지므로 게임플레이가 점점 어려워진다는 특징이 있습니다.

기본적인 게임의 코드로는 깃허브에 올라와 있는 swift 언어로 이루어진 ios 앱 전용 소스코드를 활용하였습니다.

[출처] https://github.com/PGSSoft/3DSnakeAR

AR 모드도 바로 사용이 가능합니다.

### 인공지능 적용

#### 유전 알고리즘

유전 알고리즘 (Genetic Algorithm) 을 활용하였습니다. 이 때 유전 알고리즘이란 존 홀랜드가 다윈 진화론의 적자생존에 기반하여 개발한 최적화 연산 방법으로, 진화론에서 최종적으로 살아남는 종은 변화에 가장 발빠르게 적응하는 종이라는 점이라는 이론을 활용하며, 생물학의 적자생존 법칙을 모방합니다.

전체적인 과정

1) 환경에 적합한 개체가 살아남음 (fitness)

2) 살아남은 개체가 번식에 성공 (natural selection)

3) 짝지어진 부모의 유전자 (crossover) + 돌연변이 (mutation) 로 자손 생성

 이를 뱀게임에 적용하여 설명하면, 여러마리의 뱀을 풀어서 마음대로 플레이 하도록 한뒤, 꼬리가 길어진 정도, 살아남은 시간에 따라 각각 개체의 적응도 (fitness) 를 측정하는 것입니다. 이후 적응도가 높은 뱀은 살리며, 나머지 뱀들은 다시 새로운 개체로 교체합니다. 이 때 교배 (crossover) 가 이루어지며 세대가 바뀌는데, 이 과정에 돌연변이 (mutation) 를 적용하여 돌연변이를 통한 진화의 가능성도 고려해 줍니다.

뱀게임에 유전 알고리즘을 적용하기 위하여 이와 관련된 영상들을 시청하며 소스코드를 분석하였습니다.

[출처] https://www.youtube.com/watch?v=zIkBYwdkuTk

[출처] https://github.com/greerviau/SnakeAI

Processing 언어로 작성된 소스코드를 ios 앱에 적용하기 위해 swift 코드로 작성하는 과정이 필요하였고, 이를 위해선 기존소스코드에 대한 이해도가 요구되었습니다. 따라서, 이 과정에 많은 시간을 투자하였습니다.

### 인공 신경망

다음은, 적용도 인공신경망의 관한 간략한 설명입니다.

<img width="177" alt="Screen Shot 2022-03-23 at 5 25 41 AM" src="https://user-images.githubusercontent.com/70687318/159569702-190030d0-008f-4cc7-b63b-0e74d519ca86.png">

이번 프로젝트에 적용된, 뱀에 뇌라고 볼 수 있는 인공신경망의 구조는 위의 이미지와 같습니다. 첫번째 입력층에 24개의 input neurons 이 존재하며, 이후 2개의 히든층에 18개씩 hidden neurons 이 존재합니다. 마지막으로 output neurons 은 4개입니다.

입력층의 24개의 뉴런이 의미하는 바는 다음 이미지의 8가지 방향과 관련이 있습니다.

<img width="310" alt="Screen Shot 2022-03-23 at 5 26 19 AM" src="https://user-images.githubusercontent.com/70687318/159569828-2cc95336-37d0-4200-a912-a58b959d4e2d.png">

뱀의 머리에 8가지의 센서를 달았습니다. 2D 상에서 뱀의 머리가 바라볼 수 있는 모든 방향은 위와 같이 8가지 입니다. 해당 8가지의 방향으로 각각 음식이 얼마나 떨어져 있는지, 자신의 몸과 얼마나 떨어져 있는지, 벽과 얼마나 멀리 떨어져 있는지를 측정합니다. 즉 각각의 방향에서 3가지의 요소를 측정하므로 실제로 입력되는 input 은 8 * 3 인 24개의 neuron 입니다.

마지막 4개의 output 은 움직일 방향입니다. 왼쪽, 오른쪽, 위쪽, 아래쪽으로 4가지ㄱ 존재합니다.

즉 24개의 센서를 통한 인풋을 입력받은 후, 2개의 히든층을 거쳐 판단을 한 뒤, 4가지 방향 중 한가지 방향을 선택하여 움직입니다.

### 시행착오 및 해결

소스코드 분석을 마친 뒤, 앞서 준비한 기본적인 ios 전용 snake 게임에 해당 유전 알고리즘을 적용하는 과정을 진행하였습니다. 이 때, 예상치 못하였다면 거짓말인 메모리 초과 문제를 마주하게 되었습니다.

기존의 Processing 언어로 작성된 소스코드는 총 2000 마리에 뱀을 동시에 학습시킵니다. 그러나 iOS 앱에서는 약 500 마리에 뱀을 동시에 학습하는 것이 최대였으며, 이 또한 불안정했다. 개체수가 너무 적어, 학습하는데 너무 오랜 시간이 걸린다고 판단하였고, 이에 따라 앱의 구성을 변경하기로 결정 하였습니다.

변경한 방식은 iOS 디방이스에서 학습을 수행하는 것이 아닌, 이를 불러올 수 있는 코드를 작성하여, 미리 학습된 모델을 불러와 인공지능을 시뮬레이션 하는 용도로 사용하는 것입니다. Processing 언어로 작성한 소스코드 즉, 컴퓨터로 수행할 수 있는 프로그램에서 모델을 학습시킨 후 이를 csv 파일에 저장하였고, iOS 앱의 패키지에 포함시켰습니다.

미리 뱀의 뇌를 학습시켜 놓은 뒤, iOS 디바이스에서 시뮬레이션 하는 방식을 생각하면 될 것 같습니다.

